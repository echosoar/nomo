<!DOCTYPE html>
<html>
	<head>
		<title>Nomo Data Mock Tool</title>
		<meta charset="utf-8"/>
	</head>
	<style>
	@keyframes loading {
		0% {
			transform:rotate(0deg);
		}
		100% {
			transform:rotate(360deg);
		}
	}
	body {
		background:#e5e5e5;
		margin:0;
		font-family:微软雅黑,黑体,Helvetica,华文黑体;
	}
	#welcome {
		position:fixed;
		width:100%;
		min-width:960px;
		height:100%;
		z-index:20;
		background:#e5e5e5;
		font-size:64px;
		transition:height 1s ease,font-size 1s ease,background 1s ease;
	}
	#welcome i {
		display:block;
		position:absolute;
		top:50%;
		width:100%;
		text-align:center;
		transform: translateY(-50%);
		height:60px;
		line-height:60px;
		font-weight:bold;
		text-align:center;
		color:#fff;
		
		text-shadow:0 0 2px #666;
		
	}
	#main{
		position:relative;
		top: 60px;
		width:960px;
		margin:0 auto;
	}
	#api{
		position:relative;
		display:none;
		top: 60px;
		width:960px;
		margin:0 auto;
	}
	#copyright {
		position:relative;
		top: 80px;
		width:960px;
		margin:0 auto;
		height:40px;
		line-height:40px;
		font-size:12px;
		color:#999;
		text-align:center;
	}
	#copyright a{
		color:#666;
		text-decoration:none;
	}
	#title-host,#title-api {
		height:60px;
		line-height:60px;
		font-size:20px;
		color: #666;
	}
	#add-new-host,#add-new-api {
		position:absolute;
		right:0;
		top:12px;
		height:36px;
		line-height:36px;
		width:140px;
		cursor:pointer;
		font-size:12px;
		color:#fff;
		text-align:center;
		border-radius:18px;
		background:#9c9;
		transition:background .5s ease;
	}
	
	#add-new-form,#add-new-api-form {
		//display:none;
		background:#709;
		height:60px;
		line-height:60px;
		color:#fff;
		text-shadow:0 0 1px #333;
		font-size:14px;
		position:relative;
		padding-right:140px;
		border-radius:5px;
		padding-left:200px;
		margin-bottom:10px;
	}
	#add-new-form:before{
		content: "Address( No Http/Https ):";
		position:absolute;
		top:0;
		left:0;
		width:200px;
		text-align:center;
	}
	#add-new-api-form:before{
		content: "Api Name:";
		position:absolute;
		top:0;
		left:0;
		width:200px;
		text-align:center;
	}
	#add-new-address,#add-new-apiaddress{
		width:100%;
		padding:0;
		height:60px;
		line-height:60px;
		border:0;
		outline:none;
		font-size:24px;
		color:#fff;
		background:transparent;
	}
	.btn-circle {
		width:40px;
		height:40px;
		border-radius:20px;
		line-height:40px;
		font-size:10px;
		font-style:normal;
		font-weight:bold;
		text-align:center;
		cursor:pointer;
		background:#696;
		transition:background .5s ease;
	}
	.btn-circle:hover{
		background:#363;
	}
	#add-new-ok,#add-new-cancel{
		position:absolute;
		top:10px;
		background:#99f;
		transition:background .5s ease;
	}
	#add-new-ok {
		right:60px;
	}
	#add-new-cancel {
		right:10px;
	}
	#add-new-ok:hover,#add-new-cancel:hover{
		background:#cc0;
	}
	
	#add-new-api-ok,#add-new-api-cancel{
		position:absolute;
		top:10px;
		background:#99f;
		transition:background .5s ease;
	}
	#add-new-api-ok {
		right:60px;
	}
	#add-new-api-cancel {
		right:10px;
	}
	#add-new-api-ok:hover,#add-new-api-cancel:hover{
		background:#cc0;
	}
	
	
	#loading {
		height:60px;
		border-radius:5px;
		position:relative;
	}
	#loading i{
		display:block;
		width:24px;
		height:24px;
		border:3px solid #393;
		border-radius:30px;
		margin:15px auto;
		border-left:3px solid transparent;
		border-right:3px solid transparent;
		animation:loading .5s linear infinite;
	}
	.host-list-noitem {
		background:#efefef;
		height:60px;
		line-height:60px;
		color:#fff;
		text-shadow:0 0 2px #000;
		font-size:24px;
		font-weight:bold;
		position:relative;
		text-align:center;
		border-radius:5px;

	}
	.host-list-item{
		background:#9c9;
		height:60px;
		line-height:60px;
		color:#fff;
		text-shadow:0 0 2px #000;
		font-size:24px;
		font-weight:bold;
		position:relative;
		padding-right:200px;
		border-radius:5px;
		padding-left:30px;
		margin-bottom:10px;
	}
	.host-list-api {
		position:absolute;
		top:10px;
		right:60px;
	}
	.host-list-del {
		position:absolute;
		top:10px;
		right:10px;
	}
	#return-to-host-list {
		display:inline-block;
		color:#fff;
		font-size:12px;
		padding:0 10px;
		position:relative;
		top:-2px;
		height:30px;
		line-height:30px;
		background:#9c9;
		margin-right:10px;
		border-radius:3px;
		cursor:pointer;
		transition:background .5s ease;
	}
	#api-info {
		background:#efefef;
		height:60px;
		line-height:60px;
		color:#fff;
		text-shadow:0 0 2px #000;
		font-size:24px;
		font-weight:bold;
		position:relative;
		text-align:center;
		border-radius:5px;
	}
	#api-info-regetip{
		display:none;
		position:absolute;
		top:10px;
		right:10px;
		width:40px;
		height:40px;
		border-radius:20px;
		line-height:40px;
		font-size:10px;
		font-style:normal;
		font-weight:bold;
		text-align:center;
		cursor:pointer;
		background:#9c9;
		transition:background .5s ease;
	}
	#api-info-setip{
		display:none;
		position:absolute;
		top:10px;
		left:10px;
		width:40px;
		height:40px;
		border-radius:20px;
		line-height:40px;
		font-size:10px;
		font-style:normal;
		font-weight:bold;
		text-align:center;
		cursor:pointer;
		background:#9c9;
		transition:background .5s ease;
	}
	
	#add-new-host:hover,#api-info-regetip:hover,#add-new-api:hover,#return-to-host-list:hover,#api-info-setip:hover{
		background:#696;
	}
	</style>
	<body>
		<div id="welcome"><i>Nomo Data Mock Tool</i><br /></div>
		<div id="main">
			<div id="title-host">Host List</div>
			<div id="add-new-host">Add New Host Bind</div>
			<div id="loading"><i></i></div>
			<div id="add-new-form"><input type="text" id="add-new-address" placeholder="www.example.com"/><i id="add-new-ok" class="btn-circle">OK</i><i id="add-new-cancel" class="btn-circle">Close</i></div>
			<div id="host-list"></div>
		</div>
		<div id="api">
			<div id="title-api"><span id="return-to-host-list">Return</span><span id="title-api-host"></span> Api List</div>
			<div id="add-new-api">Add New Api</div>
			<div id="api-info">
				<span id="api-info-ip">Loading IP Address</span>
				<i id="api-info-setip">Set</i>
				<i id="api-info-regetip">Reget</i>
			</div>
			<div id="add-new-api-form">
				<input type="text" id="add-new-apiaddress" placeholder="/example.do"/><i id="add-new-api-ok" class="btn-circle">OK</i><i id="add-new-api-cancel" class="btn-circle">Close</i>
				<div id="api-item-list"></div>
			</div>
		</div>
		<div id="copyright">© 2016 <a href='http://iwenku.net' target="_blank">IWenKu.net</a> Copyright All Reversed.</div>
	</body>
	<script>
		var getXhr = function(){
			if(window.XMLHttpRequest){
				var xhr=new XMLHttpRequest();
			}else{
				try{
					var xhr=new ActiveXObject("Msxml2.XMLHTTP");
				}catch(e){
					try{
						var xhr=new ActiveXObject("Microsoft.XMLHTTP");
					}catch(e){
						throw new TypeError('Unsupport XMLHttpRequest');
					}
				}
			}
			return xhr;
		}
		
		function getHostList(){
			var xhr = getXhr();
			xhr.onreadystatechange = function(){
				if(xhr.readyState==4){
					if(xhr.status == 200){
						nodeStyle("host-list").innerHTML = "";
						nodeStyle("loading",{display:"none"});
						var data = JSON.parse(xhr.responseText);
						if(data.num>0){
							var fragment = document.createDocumentFragment("div");
							data.data.forEach(function(v,index){
								var temElement = document.createElement("div");
								temElement.setAttribute("id","host-list-item-"+index);
								temElement.setAttribute("class","host-list-item");
								temElement.innerHTML = v + '<i class="host-list-api btn-circle" id="host-list-api-'+index+'">Api</i><i class="host-list-del btn-circle" id="host-list-del-'+index+'">Del</i>';
								fragment.appendChild(temElement);
							});
							
							nodeStyle("host-list").appendChild(fragment);
						}else{
							var temElement = document.createElement("div");
							temElement.setAttribute("class","host-list-noitem");
							temElement.innerHTML = "No Host Bind Now!";
							nodeStyle("host-list").appendChild(temElement);
						}
					}
				}
			}
			xhr.open("GET","/api/hostList");
			xhr.send(null);
		}
		
		function nodeStyle(element,style){
			element = document.getElementById(element);
			if(style){
				for(var i in style){
					element.style[i]=style[i];
				}
			}
			return element;
		}
	
		setTimeout(function(){
			nodeStyle("welcome",{"height":"60px","fontSize":"20px","backgroundColor":"#9c9"});
			getHostList();
		},0);
		
		document.getElementById("add-new-host").onclick = function(){
			nodeStyle("add-new-form",{display:"block"});
			nodeStyle("loading",{display:"none"});
		}
		document.getElementById("add-new-cancel").onclick = function(){
			nodeStyle("add-new-address").value = "";
			nodeStyle("add-new-form",{display:"none"});
		}
		document.getElementById("add-new-ok").onclick = function(){
			var address = nodeStyle("add-new-address").value.replace(/\s/g,"");
			if(!address)return;
			nodeStyle("add-new-form",{display:"none"});
			nodeStyle("loading",{display:"block"});
			
			var xhr = getXhr();
			xhr.onreadystatechange = function(){
				if(xhr.readyState==4){
					if(xhr.status == 200){
						nodeStyle("loading",{display:"none"});
						var data = JSON.parse(xhr.responseText);
						console.log(data);
						if(data.res>0){
							getHostList();
						}
					}
				}
			}
			xhr.open("GET","/api/addNewHost/?host="+address);
			xhr.send(null);
		}
		
		document.body.onclick = function(e){
			e = e || window.e;
			var target = e.target || e.srcElement;
			
			if(target.innerHTML == "Del" && confirm("Do you really want to delete this one?")){
				var id = target.getAttribute("id").split("-").pop();
				var preHTML = target.parentNode.innerHTML;
				var host = preHTML.split("<")[0];
				target.parentNode.innerHTML = "Deleting...";
				
				var xhr = getXhr();
				xhr.onreadystatechange = function(){
					if(xhr.readyState==4){
						if(xhr.status == 200){
							getHostList();
						}
					}
				}
				xhr.open("GET","/api/deleteHost/?host="+host);
				xhr.send(null);
			}else if(target.innerHTML == "Api"){
				var host = target.parentNode.innerHTML.split("<")[0];
				nodeStyle("main",{display:"none"});
				nodeStyle("api",{display:"block"});
				nodeStyle("title-api-host").innerHTML= host;
				getConfig(host);
			}
		}
		
		nodeStyle("return-to-host-list").onclick = function(){
			nodeStyle("api",{display:"none"});
			nodeStyle("main",{display:"block"});
			nodeStyle("api-info-regetip",{display:"none"});
			nodeStyle("api-info-setip",{display:"none"});
		}
		nodeStyle("api-info-regetip").onclick = function(){
			nodeStyle("api-info-ip").innerHTML = "Loading IP Address";
			nodeStyle("api-info-regetip",{display:"none"});
			nodeStyle("api-info-setip",{display:"none"});
			var host = nodeStyle("title-api-host").innerHTML;
			getIp(host);
		}
		nodeStyle("api-info-setip").onclick = function(){
			var host = nodeStyle("title-api-host").innerHTML;
			var res = prompt("Please Input Ip Address","");
			var host = nodeStyle("title-api-host").innerHTML;
			if(/(\d{1,3}\.){3}\d{1,3}/.test(res)){
				
				var xhr = getXhr();
				xhr.open("GET","/api/setHostIp/?ip="+res+"&host="+host);
				xhr.onreadystatechange = function(){
					if(xhr.readyState==4){
						if(xhr.status == 200){
							var data = JSON.parse(xhr.responseText);
							if(data.res==1){
								nodeStyle("api-info-ip").innerHTML = data.ip;
							}else{
								nodeStyle("api-info-ip").innerHTML = "IP Address Set Error!";
							}
						}
					}
				}
				xhr.send(null);
				
			}else if(res != null){
				alert("Ip Address Format Error!");
			}
		}
		function getConfig(host){
			nodeStyle("api-info-ip").innerHTML = "Loading IP Address";
			var xhr = getXhr();
			xhr.open("GET","/api/getConfigByHost/?host="+host);
			xhr.onreadystatechange = function(){
				if(xhr.readyState==4){
					if(xhr.status == 200){
						var data = JSON.parse(xhr.responseText);
						
						if(data.res==1 && data.config.ip!=false){
							nodeStyle("api-info-ip").innerHTML = data.config.ip;
						}else{
							nodeStyle("api-info-ip").innerHTML ="Can not get ip , please manually set!";
						}
						
						nodeStyle("api-info-setip",{display:"block"});
						nodeStyle("api-info-regetip",{display:"block"});
					}
				}
			}
			xhr.send(null);
		}
		function getIp(host){
			var xhr = getXhr();
			xhr.open("GET","/api/getIpByHost/?host="+host);
			xhr.onreadystatechange = function(){
				if(xhr.readyState==4){
					if(xhr.status == 200){
						var data = JSON.parse(xhr.responseText);
						if(data.res==1 && data.ip!=false){
							nodeStyle("api-info-ip").innerHTML = data.ip;
						}else{
							nodeStyle("api-info-ip").innerHTML ="Can not get ip , please manually set!";
						}
						nodeStyle("api-info-setip",{display:"block"});
						nodeStyle("api-info-regetip",{display:"block"});
					}
				}
			}
			xhr.send(null);
		}
		
	</script>
</html>